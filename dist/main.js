!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var s={};i.r(s),i.d(s,"getCurrentTime",(function(){return a})),i.d(s,"random",(function(){return r})),i.d(s,"randomPositiveNegative",(function(){return n})),i.d(s,"isFunction",(function(){return o})),i.d(s,"isTouchDevice",(function(){return h})),i.d(s,"requestAnimationFrameTool",(function(){return c})),i.d(s,"arraySwap",(function(){return d}));const a=()=>performance.now(),r=(e,t)=>Math.random()*(t-e)+e,n=()=>Math.random()<.5?-1:1,o=e=>"function"==typeof e,h=()=>"ontouchstart"in window||window.navigator.msMaxTouchPoints,c=(()=>{let e=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(t=>{window.setTimeout(()=>{const i=a();t(i);const s=a();e=1e3/60-(s-i)},e)})})(),d=(e,t,i)=>{const s=e[i];e[i]=e[t],e[t]=s};var l={linear:function(e,t,i,s){return i*e/s+t},easeIn:function(e,t,i,s){return i*(e/=s)*e+t},easeOut:function(e,t,i,s){return-i*(e/=s)*(e-2)+t},easeInOut:function(e,t,i,s){return(e/=s/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t}};const{requestAnimationFrameTool:u,isFunction:g,isTouchDevice:m}=s;class b{constructor(e={}){if(!document.createElement("canvas").getContext)return void window.alert("HTML5 Canvas is not supported in your browser.");const{canvasId:t,debug:i,width:a,height:r,highResolution:n,loadLimit:o,soundOn:h}=e;let c=a||window.innerWidth,d=r||window.innerHeight;this.canvas=document.getElementById(t),n&&(this.canvas.style.width=c+"px",this.canvas.style.height=d+"px",c*=2,d*=2),this.highResolution=n,this.canvas.width=c,this.canvas.height=d,this.width=this.canvas.width,this.height=this.canvas.height,this.calWidth=.5*this.width,this.calHeight=.5*this.height,this.debug=!!i,this.ctx=this.canvas.getContext("2d"),this.defaultLayer="default",this.layerArr=[this.defaultLayer],this.instancesObj={},this.instancesObj[this.defaultLayer]=[],this.instancesReactionArr=[],this.utils=s,this.customVariable={};const l=this;this.isTouchDevice=m(),this.debugArr=[],this.assetsObj={image:{},audio:{}},this.assetsCount={image:0,audio:0},this.assetsErrorQueue=[],this.assetsErrorCount=0,this.loadLimit=o||3,this.soundOn=!!h,this.fps=0,this.lastTime=0,this.lastPausedAt=0,this.pausedTime=0,this.paused=!1,this.timeMovement={},this.timeMovementStartArr=[],this.timeMovementFinishArr=[],this.keyUpListeners={},this.keyDownListeners={},this.keyPressListeners={},this.startAnimate=()=>{},this.paintUnderInstance=()=>{},this.paintAboveInstance=()=>{},this.endAnimate=()=>{},this.touchStartListener=()=>{},this.touchEndListener=()=>{},this.touchMoveListener=()=>{},document.addEventListener("keyup",e=>{l.keyListener(e,"keyup")},!1),document.addEventListener("keydown",e=>{l.keyListener(e,"keydown")},!1),document.addEventListener("keypress",e=>{l.keyListener(e,"keypress")},!1),this.isTouchDevice?(document.addEventListener("touchstart",e=>{l.touchStartListener(e)},!1),document.addEventListener("touchend",e=>{l.touchEndListener(e)},!1),document.addEventListener("touchmove",e=>{l.touchMoveListener(e)},!1)):(document.addEventListener("mousedown",e=>{l.touchStartListener(e)},!1),document.addEventListener("mouseup",e=>{l.touchEndListener(e)},!1),document.addEventListener("mousemove",e=>{l.touchMoveListener(e)},!1))}triggerReaction(e,t){let i=e,s=t;this.highResolution&&(i*=2,s*=2),this.instancesReactionArr.forEach(e=>{e.visible&&i>=e.x&&i<=e.x+e.width&&s>=e.y&&s<=e.y+e.height&&e.trigger(e,this)})}addAudio(e,t,i=0){if(!this.soundOn)return;i||(this.assetsCount.audio+=1);const s=new window.Audio;s.src=t,this.assetsObj.audio[e]=s,s.addEventListener("error",()=>{this.assetsErrorQueue.push({name:e,src:t,retry:i+1,type:"audio"})},!1),s.load()}getAudio(e){return this.assetsObj.audio[e]}playAudio(e,t=!1){if(!this.soundOn)return;const i=this.getAudio(e);if(i){if(i.play(),!t)return;i.addEventListener("ended",()=>{i.currentTime=0,i.play()},!1)}}pauseAudio(e){const t=this.getAudio(e);t&&t.pause()}setVariable(e,t){this.customVariable[e]=t}getVariable(e,t=null){const i=this.customVariable[e];return i||(null!==t?(this.setVariable(e,t),t):null)}addImg(e,t,i=0){i||(this.assetsCount.image+=1);const s=new window.Image;s.src=t,s.onload=()=>{this.assetsObj.image[e]=s},s.onerror=()=>{this.assetsErrorQueue.push({name:e,src:t,retry:i+1,type:"image"})}}getImg(e){return this.assetsObj.image[e]}animate(e){const t=e-this.pausedTime,i=this;this.paused?setTimeout(()=>{this.animate.call(i,t)},100):(this.tick(t),this.clean(),this.startAnimate(this,t),this.paintUnderInstance(this),this.updateInstances(t),this.paintInstances(),this.paintAboveInstance(),this.endAnimate(this,t),this.tickTimeMovement(),this.debug&&this.showFps(),this.debug&&this.drawDebug(),u(e=>{this.animate.call(i,e)}))}showFps(){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.font=(this.highResolution?32:16)+"px Arial",this.ctx.fillText("FPS: "+this.fps.toFixed(),5,this.highResolution?40:20),this.ctx.restore()}debugLineX(e){this.debugArr.push({type:"lineX",y:e})}debugLineY(e){this.debugArr.push({type:"lineY",x:e})}debugDot(e,t){this.debugArr.push({type:"dot",x:e,y:t})}drawDebug(){this.debugArr.forEach(e=>{const{type:t,x:i,y:s}=e;switch(t){case"dot":this.drawDebugDot(i,s);break;case"lineX":this.drawDebugLine(null,s);break;case"lineY":this.drawDebugLine(i,null)}}),this.instancesReactionArr.forEach(e=>{e.visible&&(this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.rect(e.x,e.y,e.width,e.height),this.ctx.stroke())})}drawDebugLine(e,t){let i=[0,t],s=[this.width,t];e&&(i=[e,0],s=[e,this.height]),this.ctx.save(),this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.moveTo(...i),this.ctx.lineTo(...s),this.ctx.stroke(),this.ctx.restore()}drawDebugDot(e,t){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(e,t,2,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(e,t,1,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.restore()}tick(e){this.updateFps(e),this.lastTime=e}updateFps(e){0===this.lastTime?this.fps=60:this.fps=1e3/(e-this.lastTime)}pixelsPerFrame(e){return e/this.fps}tickTimeMovement(){this.timeMovementStartArr.forEach(e=>{this.timeMovement[e].processing=!0}),this.timeMovementStartArr=[],this.timeMovementFinishArr.forEach(e=>{delete this.timeMovement[e]}),this.timeMovementFinishArr=[]}getTimeMovement(e,t,i,s={}){const{before:a,after:r}=s,n=l[s.easing||"linear"],o=s.name||"default",h=this.timeMovement[e];if(!h)return;h.processing||(this.timeMovementStartArr.push(e),h.store[o]=[],t.forEach(e=>{h.store[o].push({start:parseFloat(e[0]),end:parseFloat(e[1])})}),a&&a());const c=(e=!1)=>{const{duration:t}=h;let s=t;if(!e){const e=this.utils.getCurrentTime(),{startTime:t}=h;s=e-t}const a=h.store[o].map(e=>n(s,e.start,e.end-e.start,t));i.apply(this,a)};this.checkTimeMovement(e)?c():(this.timeMovementFinishArr.push(e),c(!0),r&&r())}checkTimeMovement(e){const t=this.timeMovement[e]||{};return this.utils.getCurrentTime()<=t.endTime}setTimeMovement(e,t){const i=this.utils.getCurrentTime();this.timeMovement[e]={startTime:i,endTime:i+t,duration:t,store:{}}}clean(){this.ctx.clearRect(0,0,this.width,this.height),this.debugArr=[]}addLayer(e){this.layerArr.push(e),this.instancesObj[e]=[]}removeLayer(e){this.layerArr=this.layerArr.filter(t=>t!==e),delete this.instancesObj[e]}swapLayer(e,t){this.utils.arraySwap(this.layerArr,e,t)}addInstance(e,t=this.defaultLayer){this.instancesObj[t].push(e),e.trigger&&this.instancesReactionArr.push(e)}getInstance(e,t=this.defaultLayer){return this.instancesObj[t].filter(t=>t.name===e)[0]}removeInstance(e,t=this.defaultLayer){const i=this.getInstance(e,t);i&&(this.instancesObj[t]=this.instancesObj[t].filter(t=>t.name!==e),i.trigger&&(this.instancesReactionArr=this.instancesReactionArr.filter(t=>t.name!==e)))}updateInstances(e){this.layerArr.forEach(t=>{this.instancesObj[t].forEach(t=>{t.update&&t.update(this,e)})})}paintInstances(){this.layerArr.forEach(e=>{this.instancesObj[e].forEach(e=>{e.paint&&e.paint(this)})})}togglePaused(){const e=this.utils.getCurrentTime();this.paused=!this.paused,this.paused?this.lastPausedAt=e:this.pausedTime+=e-this.lastPausedAt}addKeyUpListener(e,t){this.keyUpListeners[e]=t}addKeyDownListener(e,t){this.keyDownListeners[e]=t}addKeyPressListener(e,t){this.keyPressListeners[e]=t}findKeyListener(e,t){return"keyup"===t?this.keyUpListeners[e]:"keydown"===t?this.keyDownListeners[e]:this.keyPressListeners[e]}keyListener(e,t){let i;switch(e.keyCode){case 13:i="enter";break;case 32:i="space";break;case 37:i="leftArrow";break;case 39:i="rightArrow";break;case 38:i="upArrow";break;case 40:i="downArrow";break;default:i=e.keyCode}const s=this.findKeyListener(i,t);s&&s()}load(e,t){const i=setInterval(()=>{const s=this.assetsCount.image+this.assetsCount.audio,a=Object.keys(this.assetsObj.image).length+Object.keys(this.assetsObj.audio).length;t&&g(t)&&t({success:a,failed:this.assetsErrorCount,total:s}),this.assetsErrorQueue.length>0&&(this.assetsErrorQueue.forEach(e=>{const{retry:t,name:i,src:s,type:a}=e;t>=this.loadLimit?this.assetsErrorCount+=1:"image"===a?this.addImg(i,s,t):this.addAudio(i,s,t)}),this.assetsErrorQueue=[]),a===s&&(e&&g(e)?e():this.init(),clearInterval(i))},200)}init(){const e=this;u(t=>{this.animate.call(e,t)})}}class y{constructor(e={}){const{name:t,painter:i,action:s,trigger:a}=e;this.name=t,this.x=0,this.y=0,this.width=0,this.height=0,this.ax=0,this.ay=0,this.vx=0,this.vy=0,this.visible=!0,this.painter=i||null,this.action=s||null,this.trigger=a||null,this.ready=!1}paint(e){null!==this.painter&&this.visible&&this.painter(this,e)}update(e,t){null!==this.action&&this.action(this,e,t)}updateWidth(e){this.width=e,this.calWidth=e/2}updateHeight(e){this.height=e,this.calHeight=e/2}}const p="LAND",O="OUT",T=e=>e.checkTimeMovement("MOVE_DOWN_MOVEMENT"),E=(e,t)=>{const i=t?t.pixelsPerFrame:e.pixelsPerFrame.bind(e),s=e.getVariable("SUCCESS_COUNT"),a=2*e.getVariable("BLOCK_HEIGHT");return i(s<=4?1.25*a:a)},w=(e,t)=>{const i=e.getVariable("SUCCESS_COUNT"),s=e.getVariable("GAME_SCORE"),{hookSpeed:a}=e.getVariable("GAME_USER_OPTION");if(a)return a(i,s);let r;switch(!0){case i<1:r=0;break;case i<10:r=1;break;case i<20:r=.8;break;case i<30:r=.7;break;default:r=.74}return e.getVariable("HARD_MODE")&&(r=1.1),Math.sin(t/(200/r))},f=(e,t)=>{const i=e.getVariable("SUCCESS_COUNT"),s=e.getVariable("GAME_SCORE"),{landBlockSpeed:a}=e.getVariable("GAME_USER_OPTION");if(a)return a(i,s);const{width:r}=e;let n;switch(!0){case i<5:n=0;break;case i<13:n=.001;break;case i<23:n=.002;break;default:n=.003}return Math.cos(t/200)*n*r},x=e=>e.checkTimeMovement("HOOK_DOWN_MOVEMENT")?"HOOK_DOWN":e.checkTimeMovement("HOOK_UP_MOVEMENT")?"HOOK_UP":"HOOK_NORMAL",_=e=>{const{setGameFailed:t}=e.getVariable("GAME_USER_OPTION"),i=e.getVariable("FAILED_COUNT")+1;e.setVariable("FAILED_COUNT",i),e.setVariable("PERFECT_COUNT",0),t&&t(i),i>=3&&(e.pauseAudio("bgm"),e.playAudio("game-over"),e.setVariable("GAME_START_NOW",!1))},I=(e,t)=>{const{setGameScore:i,successScore:s,perfectScore:a}=e.getVariable("GAME_USER_OPTION"),r=e.getVariable("PERFECT_COUNT",0),n=t?r+1:0,o=e.getVariable("GAME_SCORE")+(s||25)+(a||25)*n;e.setVariable("GAME_SCORE",o),e.setVariable("PERFECT_COUNT",n),i&&i(o)},A=(e,t)=>{const{string:i,size:s,x:a,y:r,textAlign:n,fontName:o="wenxue",fontWeight:h="normal"}=t,{ctx:c}=e,d=s,l=.1*d;c.save(),c.beginPath();const u=c.createLinearGradient(0,0,0,r);u.addColorStop(0,"#FAD961"),u.addColorStop(1,"#F76B1C"),c.fillStyle=u,c.lineWidth=l,c.strokeStyle="#FFF",c.textAlign=n||"center",c.font=`${h} ${d}px ${o}`,c.strokeText(i,a,r),c.fillText(i,a,r),c.restore()},v=(e,t,i)=>{const s=t+1>=e.length?e.length-1:t,a=e[s],r=e[s+1>=e.length-1?s:s+1],n=e=>{const t=a[e],s=r[e];return Math.round(t+(s-t)*i)};return`rgb(${n(0)}, ${n(1)}, ${n(2)})`},M=e=>{(e=>{const t=e.ctx.createLinearGradient(0,0,0,e.height),i=[[200,255,150],[105,230,240],[90,190,240],[85,100,190],[55,20,35],[75,25,35],[25,0,10]],s=e.getVariable("BACKGROUND_LINEAR_GRADIENT_OFFSET_HEIGHT",0);T(e)&&e.setVariable("BACKGROUND_LINEAR_GRADIENT_OFFSET_HEIGHT",s+1.5*E(e));const a=parseInt(s/e.height,10),r=s%e.height/e.height,n=v(i,a,r),o=v(i,a+1,r);t.addColorStop(0,o),t.addColorStop(1,n),e.ctx.fillStyle=t,e.ctx.beginPath(),e.ctx.rect(0,0,e.width,e.height),e.ctx.fill();const h=()=>{e.ctx.fillStyle="rgba(255, 255, 255, 0.7)",e.ctx.fillRect(0,0,e.width,e.height)};e.getTimeMovement("LIGHTNING_MOVEMENT",[],()=>{},{before:h,after:h})})(e),(e=>{const t=e.getImg("background"),i=t.width,s=t.height*e.width/i;let a=e.getVariable("BACKGROUND_IMG_OFFSET_HEIGHT",e.height-s);a>e.height||(e.getTimeMovement("MOVE_DOWN_MOVEMENT",[[a,a+E(e,{pixelsPerFrame:e=>e/2})]],e=>{a=e},{name:"background"}),e.getTimeMovement("BG_INIT_MOVEMENT",[[a,a+s/4]],e=>{a=e}),e.setVariable("BACKGROUND_IMG_OFFSET_HEIGHT",a),e.setVariable("LINE_INITIAL_OFFSET",e.height-.394*s),e.ctx.drawImage(t,0,a,e.width,s))})(e)},L=(e,t,i)=>{const s=e;s.ready||(s.y=t.getVariable("LINE_INITIAL_OFFSET"),s.ready=!0,s.collisionX=t.width-t.getVariable("BLOCK_WIDTH")),t.getTimeMovement("MOVE_DOWN_MOVEMENT",[[e.y,e.y+E(t,{pixelsPerFrame:e=>e/2})]],t=>{e.y=t},{name:"line"});const a=f(t,i);e.x+=a,e.collisionX+=a},N=(e,t)=>{const{ctx:i,debug:s}=t;s&&(i.save(),i.beginPath(),i.strokeStyle="red",i.moveTo(e.x,e.y),i.lineTo(e.collisionX,e.y),i.lineWidth=1,i.stroke(),i.restore())},V=e=>{const{count:t}=e,i=e=>e[Math.floor(Math.random()*e.length)];e.imgName=i(t>6?["c4","c5","c6","c7","c8"]:["c1","c2","c3"])},S=(e,t)=>{if(!e.ready){e.ready=!0,V(e),e.width=t.getVariable("CLOUD_SIZE"),e.height=t.getVariable("CLOUD_SIZE");const i=t.width,s=t.height,a=[{x:.1*i,y:.66*-s},{x:.65*i,y:.33*-s},{x:.1*i,y:0},{x:.65*i,y:.33*s}][e.index-1];e.x=t.utils.random(a.x,1.2*a.x),e.originX=e.x,e.ax=t.pixelsPerFrame(e.width*t.utils.random(.05,.08)*t.utils.randomPositiveNegative()),e.y=t.utils.random(a.y,1.2*a.y)}e.x+=e.ax,(e.x>=e.originX+e.width||e.x<=e.originX-e.width)&&(e.ax*=-1),T(t)&&(e.y+=1.2*E(t)),e.y>=t.height&&(e.y=.66*-t.height,e.count+=4,V(e))},C=(e,t)=>{const{ctx:i}=t,s=t.getImg(e.imgName);i.drawImage(s,e.x,e.y,e.width,e.height)},k=(e,t,i)=>{const s=t.getVariable("ROPE_HEIGHT");e.ready||(e.x=t.width/2,e.y=-1.5*s,e.ready=!0),t.getTimeMovement("HOOK_UP_MOVEMENT",[[e.y,e.y-s]],t=>{e.y=t},{after:()=>{e.y=-1.5*s}}),t.getTimeMovement("HOOK_DOWN_MOVEMENT",[[e.y,e.y+s]],t=>{e.y=t},{name:"hook"});const a=t.getVariable("INITIAL_ANGLE");e.angle=a*w(t,i),e.weightX=e.x+Math.sin(e.angle)*s,e.weightY=e.y+Math.cos(e.angle)*s},R=(e,t)=>{const{ctx:i}=t,s=t.getVariable("ROPE_HEIGHT"),a=.1*s,r=t.getImg("hook");i.save(),i.translate(e.x,e.y),i.rotate(2*Math.PI-e.angle),i.translate(-e.x,-e.y),t.ctx.drawImage(r,e.x-a/2,e.y,a,s+5),i.restore()},G=(e,t,i)=>{const{width:s,height:a}=t,{name:r}=e;if(!e.ready){e.ready=!0;const i=.2*s;e.updateWidth(i),e.height=.46*i,e.x=t.calWidth-e.calWidth,e.y=.45*a,"tutorial"!==r&&(e.y+=1.2*e.height)}"tutorial"!==r&&(e.y+=Math.cos(i/200)*e.height*.01)},P=(e,t)=>{if(t.checkTimeMovement("TUTORIAL_MOVEMENT"))return;if("HOOK_NORMAL"!==x(t))return;const{ctx:i}=t,{name:s}=e,a=t.getImg(s);i.drawImage(a,e.x,e.y,e.width,e.height)},F=(e,t)=>{"ROTATE_LEFT"===e.status?e.y-e.width>=t.height&&(e.visible=!1,e.status=O,_(t)):e.y>=t.height&&(e.visible=!1,e.status=O,_(t))},U=(e,t,i)=>{const s=e,a=t.getVariable("ROPE_HEIGHT");if(!s.visible)return;s.ready||(s.ready=!0,s.status="SWING",e.updateWidth(t.getVariable("BLOCK_WIDTH")),e.updateHeight(t.getVariable("BLOCK_HEIGHT")),e.x=t.width/2,e.y=-1.5*a);const r=t.getInstance("line");switch(s.status){case"SWING":t.getTimeMovement("HOOK_DOWN_MOVEMENT",[[e.y,e.y+a]],t=>{e.y=t},{name:"block"}),((e,t,i)=>{const s=t.getVariable("ROPE_HEIGHT");if("SWING"!==e.status)return;const a=e,r=t.getVariable("INITIAL_ANGLE");a.angle=r*w(t,i),a.weightX=a.x+Math.sin(a.angle)*s,a.weightY=a.y+Math.cos(a.angle)*s})(e,t,i);break;case"BEFORE_DROP":s.x=e.weightX-e.calWidth,s.y=e.weightY+.3*e.height,s.rotate=0,s.ay=t.pixelsPerFrame(3e-4*t.height),s.startDropTime=i,s.status="DROP";break;case"DROP":const n=i-s.startDropTime;s.startDropTime=i,s.vy+=s.ay*n,s.y+=s.vy*n+.5*s.ay*n**2;const o=((e,t)=>e.y+e.height>=t.y?e.x<t.x-e.calWidth||e.x>t.collisionX+e.calWidth?1:e.x<t.x?2:e.x>t.collisionX?3:e.x>t.x+.8*e.calWidth&&e.x<t.x+1.2*e.calWidth?5:4:0)(e,r),h=r.y-e.height,c=e=>{e.originOutwardAngle=Math.atan(e.height/e.outwardOffset),e.originHypotenuse=Math.sqrt(e.height**2+e.outwardOffset**2),t.playAudio("rotate")};switch(o){case 1:F(e,t);break;case 2:s.status="ROTATE_LEFT",e.y=h,e.outwardOffset=r.x+e.calWidth-e.x,c(e);break;case 3:s.status="ROTATE_RIGHT",e.y=h,e.outwardOffset=r.collisionX+e.calWidth-e.x,c(e);break;case 4:case 5:s.status=p;const i=t.getVariable("SUCCESS_COUNT");(e=>{const{setGameSuccess:t}=e.getVariable("GAME_USER_OPTION"),i=e.getVariable("SUCCESS_COUNT")+1;e.setVariable("SUCCESS_COUNT",i),e.getVariable("HARD_MODE")&&e.setVariable("ROPE_HEIGHT",e.height*e.utils.random(.35,.55)),t&&t(i)})(t),t.setTimeMovement("MOVE_DOWN_MOVEMENT",500),10!==i&&15!==i||t.setTimeMovement("LIGHTNING_MOVEMENT",150),e.y=h,r.y=h,r.x=s.x-s.calWidth,r.collisionX=r.x+s.width;const a=.3*s.width;(s.x>t.width-2*a||s.x<-a)&&t.setVariable("HARD_MODE",!0),5===o?(e.perfect=!0,I(t,!0),t.playAudio("drop-perfect")):(I(t),t.playAudio("drop"))}break;case p:t.getTimeMovement("MOVE_DOWN_MOVEMENT",[[e.y,e.y+E(t,{pixelsPerFrame:e=>e/2})]],i=>{e.visible&&(e.y=i,e.y>t.height&&(e.visible=!1))},{name:e.name}),e.x+=f(t,i);break;case"ROTATE_LEFT":case"ROTATE_RIGHT":const d="ROTATE_RIGHT"===s.status,l=t.pixelsPerFrame(4*Math.PI),u=d?1:-1;if(d?e.rotate>1.3:e.rotate<-1.3)e.rotate+=l/8*u,e.y+=t.pixelsPerFrame(.7*t.height),e.x+=t.pixelsPerFrame(.3*t.width)*u;else{let t=(e.calWidth-e.outwardOffset)/e.calWidth;t=t>.5?t:.5,e.rotate+=l*t*u;const i=e.originOutwardAngle+e.rotate,s=d?r.collisionX+e.calWidth:r.x+e.calWidth,a=r.y;e.x=s-Math.cos(i)*e.originHypotenuse,e.y=a-Math.sin(i)*e.originHypotenuse}F(e,t)}},D=(e,t)=>{const{perfect:i}=e,s=t.getImg(i?"block-perfect":"block");t.ctx.drawImage(s,e.x,e.y,e.width,e.height)},H=(e,t)=>{const{status:i}=e;switch(i){case"SWING":((e,t)=>{const i=t.getImg("blockRope");t.ctx.drawImage(i,e.weightX-e.calWidth,e.weightY,e.width,1.3*e.height);const s=e.weightX-e.calWidth;t.debugLineY(s)})(e,t);break;case"DROP":case p:D(e,t);break;case"ROTATE_LEFT":case"ROTATE_RIGHT":((e,t)=>{const{ctx:i}=t;i.save(),i.translate(e.x,e.y),i.rotate(e.rotate),i.translate(-e.x,-e.y),D(e,t),i.restore()})(e,t)}},W=(e,t)=>{const{visible:i,ready:s,type:a}=e;if(!i)return;const r=t.getVariable("CLOUD_SIZE");if(!s){const i=((e,t)=>{const{width:i,height:s,utils:a}=e,{random:r}=a,n=e.getVariable("CLOUD_SIZE");return{bottomToTop:{x:i*r(.3,.7),y:s,vx:0,vy:.7*e.pixelsPerFrame(s)*-1},leftToRight:{x:-1*n,y:s*r(.3,.6),vx:.4*e.pixelsPerFrame(i),vy:.1*e.pixelsPerFrame(s)*-1},rightToLeft:{x:i,y:s*r(.2,.5),vx:.4*e.pixelsPerFrame(i)*-1,vy:.1*e.pixelsPerFrame(s)},rightTopToLeft:{x:i,y:0,vx:.6*e.pixelsPerFrame(i)*-1,vy:.5*e.pixelsPerFrame(s)}}[t]})(t,a);e.ready=!0,e.width=r,e.height=r,e.x=i.x,e.y=i.y,e.vx=i.vx,e.vy=i.vy}e.x+=e.vx,e.y+=e.vy,(e.y+r<0||e.y>t.height||e.x+r<0||e.x>t.width)&&(e.visible=!1)},K=(e,t)=>{const{ctx:i}=t,s=t.getImg(e.imgName);i.drawImage(s,e.x,e.y,e.width,e.height)},B=(e,t,i)=>{if(e.getVariable("FLIGHT_COUNT")===t)return;const s=new y({name:"flight_"+t,action:W,painter:K});s.imgName="f"+t,s.type=i,e.addInstance(s,"FLIGHT_LAYER"),e.setVariable("FLIGHT_COUNT",t)},j=()=>{"undefined"!=typeof YaGames&&YaGames.init().then(e=>{console.log("Вызываю функция для остановки GameApi"),window.ysdk=e,e.features.GameplayAPI?e.features.GameplayAPI.stop():console.log("Невозможно остановить GameplayAPI")})};new MutationObserver(e=>{e.forEach(e=>{if("attributes"===e.type&&"style"===e.attributeName){const e=document.getElementById("over-zero"),t=document.getElementById("startGame");if(e){"block"===window.getComputedStyle(e).display&&(console.log("СТОП ИГРА!"),j())}if(t){"block"===window.getComputedStyle(t).display&&(console.log("СТОП ЕЩЕ НЕ НАЧАЛИ!"),j())}}})}).observe(document.body,{attributes:!0,subtree:!0});const X=e=>{const t=e.getVariable("SUCCESS_COUNT",0),i=e.getVariable("GAME_SCORE",0);document.getElementById("modal").style.display="none",e.setVariable("GAME_START_NOW",!0),e.setVariable("FAILED_COUNT",1),e.setVariable("SUCCESS_COUNT",t),e.setVariable("GAME_SCORE",i),q(e)},Y=e=>{if(!e.getVariable("GAME_START_NOW"))return;const t=e.getVariable("SUCCESS_COUNT",0);let i=e.getVariable("FAILED_COUNT");const s=e.getVariable("GAME_SCORE",0),a=Number(t)>99?.1*e.width:0,r=document.querySelector(".js-invite");let n=0;r.addEventListener("click",(function(){n<1?((e=>{"undefined"!=typeof YaGames?YaGames.init().then(t=>{console.log("Yandex SDK initialized"),window.ysdk=t,t.adv.showRewardedVideo({callbacks:{onOpen:()=>{console.log("Video ad open. reward is:")},onRewarded:()=>{console.log("Rewarded!"),X(e)},onClose:()=>{console.log("Video ad closed."),X(e)},onError:e=>{console.log("Error while open video ad:",e)}}})}):X(e)})(e),n++):r.style.display="none"})),A(e,{string:"Этаж",size:.06*e.width,x:.24*e.width+a,y:.12*e.width,textAlign:"left",fontName:"Arial",fontWeight:"bold"}),A(e,{string:t,size:.17*e.width,x:.22*e.width+a,y:.2*e.width,textAlign:"right"});const o=e.getImg("score"),h=o.width,c=o.height,d=.35*e.width,l=c*d/h;e.ctx.drawImage(o,.61*e.width,.038*e.width,d,l),A(e,{string:s,size:.06*e.width,x:.9*e.width,y:.11*e.width,textAlign:"right"});const{ctx:u}=e,g=e.getImg("heart"),m=g.width,b=g.height,y=.08*e.width,p=b*y/m;for(let t=1;t<=3;t+=1)u.save(),t<=i&&(u.globalAlpha=.2),u.drawImage(g,.66*e.width+(t-1)*y,.16*e.width,y,p),u.restore()},q=e=>{if(!e.getVariable("GAME_START_NOW"))return;const t=e.getInstance("block_"+e.getVariable("BLOCK_COUNT"));if(!t||[p,O].indexOf(t.status)>-1){if(T(e)&&E(e))return;if(e.checkTimeMovement("HOOK_UP_MOVEMENT"))return;const t=(e=>{const t=e.getVariable("SUCCESS_COUNT"),i=e.getVariable("GAME_SCORE"),{hookAngle:s}=e.getVariable("GAME_USER_OPTION");if(s)return s(t,i);if(e.getVariable("HARD_MODE"))return 90;switch(!0){case t<10:return 30;case t<20:return 60;default:return 80}})(e),i=Math.PI*e.utils.random(t,t+5)*e.utils.randomPositiveNegative()/180;e.setVariable("BLOCK_COUNT",e.getVariable("BLOCK_COUNT")+1),e.setVariable("INITIAL_ANGLE",i),e.setTimeMovement("HOOK_DOWN_MOVEMENT",500);const s=new y({name:"block_"+e.getVariable("BLOCK_COUNT"),action:U,painter:H});e.addInstance(s)}switch(Number(e.getVariable("SUCCESS_COUNT",0))){case 2:B(e,1,"leftToRight");break;case 6:B(e,2,"rightToLeft");break;case 8:B(e,3,"leftToRight");break;case 14:B(e,4,"bottomToTop");break;case 18:B(e,5,"bottomToTop");break;case 22:B(e,6,"bottomToTop");break;case 25:B(e,7,"rightTopToLeft")}};window.TowerGame=(e={})=>{const{width:t,height:i,canvasId:s,soundOn:a}=e,r=new b({canvasId:s,highResolution:!0,width:t,height:i,soundOn:a}),n=e=>"./assets/"+e;r.addImg("background",n("background.png")),r.addImg("hook",n("hook.png")),r.addImg("blockRope",n("block-rope.png")),r.addImg("block",n("block.png")),r.addImg("block-perfect",n("block-perfect.png"));for(let e=1;e<=8;e+=1)r.addImg("c"+e,n(`c${e}.png`));r.addLayer("FLIGHT_LAYER");for(let e=1;e<=7;e+=1)r.addImg("f"+e,n(`f${e}.png`));r.swapLayer(0,1),r.addImg("tutorial",n("tutorial.png")),r.addImg("tutorial-arrow",n("tutorial-arrow.png")),r.addImg("heart",n("heart.png")),r.addImg("score",n("score.png")),r.addAudio("drop-perfect",n("drop-perfect.mp3")),r.addAudio("drop",n("drop.mp3")),r.addAudio("game-over",n("game-over.mp3")),r.addAudio("rotate",n("rotate.mp3")),r.addAudio("bgm",n("bgm.mp3")),r.setVariable("BLOCK_WIDTH",.25*r.width),r.setVariable("BLOCK_HEIGHT",.71*r.getVariable("BLOCK_WIDTH")),r.setVariable("CLOUD_SIZE",.3*r.width),r.setVariable("ROPE_HEIGHT",.4*r.height),r.setVariable("BLOCK_COUNT",0),r.setVariable("SUCCESS_COUNT",0),r.setVariable("FAILED_COUNT",0),r.setVariable("GAME_SCORE",0),r.setVariable("HARD_MODE",!1),r.setVariable("GAME_USER_OPTION",e);for(let e=1;e<=4;e+=1){const t=new y({name:"cloud_"+e,action:S,painter:C});t.index=e,t.count=5-e,r.addInstance(t)}const o=new y({name:"line",action:L,painter:N});r.addInstance(o);const h=new y({name:"hook",action:k,painter:R});return r.addInstance(h),r.startAnimate=q,r.endAnimate=Y,r.paintUnderInstance=M,r.addKeyDownListener("enter",()=>{r.debug&&r.togglePaused()}),r.touchStartListener=()=>{(e=>{if(!e.getVariable("GAME_START_NOW"))return;if(e.debug&&e.paused)return;if("HOOK_NORMAL"!==x(e))return;e.removeInstance("tutorial"),e.removeInstance("tutorial-arrow");const t=e.getInstance("block_"+e.getVariable("BLOCK_COUNT"));t&&"SWING"===t.status&&(e.setTimeMovement("HOOK_UP_MOVEMENT",500),t.status="BEFORE_DROP")})(r)},r.playBgm=()=>{r.playAudio("bgm",!0)},r.pauseBgm=()=>{r.pauseAudio("bgm")},r.start=()=>{const e=new y({name:"tutorial",action:G,painter:P});r.addInstance(e);const t=new y({name:"tutorial-arrow",action:G,painter:P});r.addInstance(t),r.setTimeMovement("BG_INIT_MOVEMENT",500),r.setTimeMovement("TUTORIAL_MOVEMENT",500),r.setVariable("GAME_START_NOW",!0)},r}}]);